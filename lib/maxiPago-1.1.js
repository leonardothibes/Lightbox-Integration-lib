function maxipago(){var self=this;self.productValue="";self.config={};self.dictionary={};self.iframe=null;self.frameID=null;self.json={};self.resp={};self.TwoFieldNames=false}maxipago.prototype.init=function(){$MP.putExternalFiles();$MP.readConfig();$MP.readDictionary()};maxipago.prototype.readConfig=function(){$.ajax({url:'maxipago/config.xml',dataType:"xml",success:function(xml){$MP.config.serverUrl=$(xml).find('server_url').text();$MP.config.formWidth=parseInt($(xml).find('form_width').text());$MP.config.formHeight=parseInt($(xml).find('form_height').text());$MP.config.merchantId=$(xml).find('merchantId').text();$MP.config.urlResponse=$(xml).find('server_url_response').text();$MP.config.closeModal=$(xml).find('closeModal').text();$MP.config.timeCloseModal=$(xml).find('timeCloseModal').text();$MP.config.showRefNum=$(xml).find('showRefNum').text();$MP.config.showAmount=$(xml).find('showAmount').text()}})},maxipago.prototype.readDictionary=function(){$.ajax({url:'maxipago/dictionary.xml',dataType:"xml",success:function(xml){$MP.dictionary.fieldCustomName=$(xml).find('Field_customerName').text();$MP.dictionary.fieldFirstName=$(xml).find('Field_firstName').text();$MP.dictionary.fieldLastName=$(xml).find('Field_lastName').text();$MP.dictionary.fieldCardNumber=$(xml).find('Field_cardNumber').text();$MP.dictionary.fieldExpirationDate=$(xml).find('Field_expirationDate').text();$MP.dictionary.fieldCvv=$(xml).find('Field_CVV').text();$MP.dictionary.nameError=$(xml).find('customerName_error').text();$MP.dictionary.namesError=$(xml).find('customerNames_error').text();$MP.dictionary.cardNumberError=$(xml).find('cardNumber_error').text();$MP.dictionary.expDateError=$(xml).find('expirationDate_error').text();$MP.dictionary.cvvError=$(xml).find('cvv_error').text();$MP.dictionary.btnConfirm=$(xml).find('button_confirm').text();$MP.dictionary.btnCancel=$(xml).find('button_cancel').text();$MP.dictionary.loading=$(xml).find('loading').text();$MP.dictionary.error=$(xml).find('error').text();$MP.dictionary.success=$(xml).find('success').text();$MP.dictionary.button_close=$(xml).find('button_close').text();$MP.dictionary.refNum=$(xml).find('refNum').text();$MP.dictionary.amount=$(xml).find('amount').text();$MP.dictionary.currency=$(xml).find('currency').text();$MP.dictionary.separatorAmount=$(xml).find('separator_amount').text();$MP.dictionary.withCI=$(xml).find('with_charge_interest').text();$MP.dictionary.withoutCI=$(xml).find('without_charge_interest').text()}})};maxipago.prototype.putExternalFiles=function(){var css=document.createElement('link');css.setAttribute('type',"text/css");css.setAttribute('href',"maxipago/maxipago.css");css.setAttribute('rel',"stylesheet");document.getElementsByTagName("head").item(0).appendChild(css)};maxipago.prototype.openModal=function(){var clientLeft=(document.body.clientWidth==0?document.body.clientWidth:document.body.clientWidth);var clientTop=(document.body.clientHeight==0?document.body.clientHeight:document.body.clientHeight);var leftForm=(clientLeft-$MP.config.formWidth)/2;var topForm=(clientTop-$MP.config.formHeight)/2;var cssModal="position: absolute;width:100%;height:100%;left:0;top:0;display:none;";var cssForm="position: absolute;left:"+leftForm.toString()+"px;top:"+topForm.toString()+"px;display:none;";var html="<div id='MPmodalInside' style='"+cssModal+";opacity:0.75;filter:alpha(opacity=75);' class='MPModal'></div>"+"<div id='MPbuyForm' style='"+cssForm+";height:"+$MP.config.formHeight.toString()+"px !important;width:"+$MP.config.formWidth.toString()+"px !important;' class='MPwindow'>"+"<table cellpadding='10' cellspacing='0' class='MPTableHeader'>"+"<tr id='TRrefNum' style='display:none'><td id='mp_refNum' class='MPrefnum'></td><td id='mp_refNumValue' class='MPrefNumValue'></td><tr>"+"<tr id='TRAmount' style='display:none'><td id='mp_amount' class='MPAmount'></td><td id='mp_AmountValue' class='MPAmountValue'></td><tr>"+"<tr id='TRInstallments' style='display:none'><td colspan='2' id='mp_Installments' class='MPInstallments'></td><tr>"+"<tr id='TRspcRefNum' style='display:none'><td></td><td></td><tr>"+"</table>";if($MP.TwoFieldNames){html+="<table class='mpNames'><tr><td id='value_of_FirstName' class='MPtext'><td>"+"<td><input type='text' size='20' class'inputFirstName' maxlength='60' id='MPFirstName'/><td>"+"<td id='value_of_LastName' class='MPtext'></td>"+"<td><input type='text' size='20' class'inputLastName' maxlength='60' id='MPLastName'/>"+"<span id='MPName_error' class='MPerrorText' style='display:none'></span></td></tr></table>"+"<table cellpadding='10' cellspacing='0' class='MPTableForm'>"}else{html+="<table cellpadding='10' cellspacing='0' class='MPTableForm'><tr><td id='value_of_customerName' class='MPtext'></td>"+"<td><input type='text' size='40' maxlength='60' id='MPName'/><span id='MPName_error' class='MPerrorText' style='display:none'></span></td></tr>"}html+="<tr><td id='value_of_cardNumber' class='MPtext'></td>"+"<td><input type='text' size='20' maxlength='19' id='MPcardNumber'><span id='MPcardNumber_error' class='MPerrorText' style='display:none'></span></td></tr>"+"<tr><td id='value_of_expirationDate' class='MPtext'></td>"+"<td><select id='MPmonth'></select>&nbsp;/&nbsp;<select id='MPyear'></select>"+"<span id='MPexpirationDate_error' class='MPerrorText' style='display:none'></span></td></tr>"+"<tr><td id='value_of_CVV' class='MPtext'></td>"+"<td><input type='text' size='4' maxlength='4' id='MPcardCVV'><span id='MPCVV_error' class='MPerrorText' style='display:none'></span></td></tr>"+"</table>"+"<table cellpadding='10' cellspacing='0' class='MPTableButtons'>"+"<tr id='MPbuttons'><td></td><td class='MPbtnsMP'><a class='MPbackButton' id='MPcancelButton' onclick='$MP.hide()'></a>"+"<a class='MPbuyButton' id='MPconfirmButton' onclick='$MP.ConfirmBuy()'></a></td></tr>"+"<tr id='MPLoading' style='display:none'><td colspan='2'><span id='MPLoadingSpan' class='MPLoading'></span></td></tr>"+"<tr id='MPResponse' style='display:none'><td colspan='2'><span id='MPResponseSpan' class='MPResponse'></span></td></tr>"+"<tr id='Closebtn' style='display:none'><td colspan='2' class='MPbtnsMP'><a class='mP_closeButton' id='MPClosebtn' onclick='$MP.hide(); respMPLib();'></a></td></tr>"+"</table>"+"</div>";$(document.body).append(html);$MP.putValues();$(document.body).delegate("#MPcardNumber","keypress",function(e){return $MP.onlyNumbers(e)});$(document.body).delegate("#MPcardCVV","keypress",function(e){return $MP.onlyNumbers(e)});document.body.style.overflow="hidden";if($MP.config.showRefNum=="true"){document.getElementById('TRrefNum').style.display="block";document.getElementById('TRspcRefNum').style.display="block";$("#mp_refNumValue").html($MP.json.hp_refnum)}if($MP.config.showAmount=="true"){document.getElementById('TRAmount').style.display="block";if($MP.config.showRefNum=="true"){document.getElementById('TRspcRefNum').style.display="none"}else{document.getElementById('TRspcRefNum').style.display="none"}$("#mp_AmountValue").html($MP.dictionary.currency+" "+$MP.productValue);if($MP.json.hp_number_of_installments!=null){document.getElementById('TRInstallments').style.display="block";var amount=parseFloat($MP.productValue);var split=parseFloat($MP.json.hp_number_of_installments);var splitValue=(amount/split).toFixed(2);splitValue=splitValue.replace(".",",");var j="";if($MP.json.hp_charge_interest){j=($MP.json.hp_charge_interest=="S"?$MP.dictionary.withCI:$MP.dictionary.withoutCI)}else{j=$MP.dictionary.withoutCI}$("#mp_Installments").html($MP.json.hp_number_of_installments+"x "+$MP.dictionary.separatorAmount+" "+$MP.dictionary.currency+" "+splitValue+" "+j)}}$MP.show()};maxipago.prototype.putValues=function(){$MP.putSelectsValues();$("#value_of_customerName").html($MP.dictionary.fieldCustomName);$("#value_of_FirstName").html($MP.dictionary.fieldFirstName);$("#value_of_LastName").html($MP.dictionary.fieldLastName);$("#value_of_cardNumber").html($MP.dictionary.fieldCardNumber);$("#value_of_expirationDate").html($MP.dictionary.fieldExpirationDate);$("#value_of_CVV").html($MP.dictionary.fieldCvv);if($MP.TwoFieldNames){$("#MPName_error").html($MP.dictionary.namesError)}else{$("#MPName_error").html($MP.dictionary.nameError)}$("#MPcardNumber_error").html($MP.dictionary.cardNumberError);$("#MPexpirationDate_error").html($MP.dictionary.expDateError);$("#MPCVV_error").html($MP.dictionary.cvvError);$("#MPconfirmButton").html($MP.dictionary.btnConfirm);$("#MPcancelButton").html($MP.dictionary.btnCancel);$("#MPLoadingSpan").html($MP.dictionary.loading);$("#MPClosebtn").html($MP.dictionary.button_close);$("#mp_refNum").html($MP.dictionary.refNum);$("#mp_amount").html($MP.dictionary.amount)};maxipago.prototype.putSelectsValues=function(){var monthSelect=document.getElementById("MPmonth");var yearSelect=document.getElementById("MPyear");var option="";var vl="";var vlY="";var dt=new Date();var year=dt.getFullYear();for(var i=0;i<12;i++){vl=i+1;vl=vl.toString();if(vl.length==1){vl="0"+vl}option=document.createElement("option");option.text=vl;option.value=vl;monthSelect.add(new Option(vl,vl))}for(var j=0;j<10;j++){vlY=(year+j);option=document.createElement("option");option.text=vlY;option.value=vlY;yearSelect.add(new Option(vlY,vlY))}};maxipago.prototype.onlyNumbers=function(e){var key=(window.event?event.keyCode:e.which);if((key>47&&key<58))return true;else{if(key==8||key==0)return true;else return false}};maxipago.prototype.hideErrors=function(){$("#MPName_error").hide();$("#MPcardNumber_error").hide();$("#MPCVV_error").hide()};maxipago.prototype.show=function(){$("#MPmodalInside").show();$("#MPbuyForm").show()};maxipago.prototype.showLoading=function(on){if(on){$("#MPbuttons").hide();$("#MPLoading").show('fade')}else{$("#MPLoading").hide();$("#MPbuttons").show('fade')}};maxipago.prototype.hide=function(){document.body.style.overflow="auto";$("#MPmodalInside").hide();$("#MPbuyForm").hide();setTimeout(function(){$("#MPmodalInside").remove();$("#MPbuyForm").remove()},200)};maxipago.prototype.Buy=function(json){if(json.hp_processor_id==null){alert("hp_processor_id cannot be null");return false}if(json.hp_txntype==null){alert("hp_txntype cannot be null");return false}if(json.hp_amount==null){alert("hp_amount cannot be null");return false}if(json.hp_refnum==null){alert("hp_refnum cannot be null");return false}if(json.hp_sig_itemid==null){alert("hp_sig_itemid cannot be null");return false}if(json.hp_sig_id==null){alert("hp_sig_id cannot be null");return false}$MP.productValue=json.hp_amount;if($MP.config.formHeight==null){console.log("error - xml config - não carregado")}else{$MP.json=json;if($MP.json.hp_save_customer){if($MP.json.hp_save_customer=="1"){$MP.TwoFieldNames=true}}$MP.openModal()}};maxipago.prototype.ConfirmBuy=function(){$MP.showLoading(true);$MP.hideErrors();var cardNumber=document.getElementById("MPcardNumber").value;var cvvNumber=document.getElementById("MPcardCVV").value;var name="";if($MP.TwoFieldNames){var first=document.getElementById("MPFirstName").value;var last=document.getElementById("MPLastName").value;if(first==""||last==""){$("#MPName_error").show();$MP.showLoading(false);return false}}else{name=document.getElementById("MPName").value;if(name==""){$("#MPName_error").show();$MP.showLoading(false);return false}}if(cardNumber==""){$("#MPcardNumber_error").show();$MP.showLoading(false);return false}if(cvvNumber==""){$("#MPCVV_error").show();$MP.showLoading(false);return false}$MP.CompleteJson(name,cardNumber,cvvNumber);var url=$MP.concatUrl();$MP.sendRequest(url)};maxipago.prototype.CompleteJson=function(name,cardNumber,cvvNumber){var cardMonth=document.getElementById("MPmonth");var cardYear=document.getElementById("MPyear");var dt=new Date();$MP.json.hp_merchant_id=$MP.config.merchantId;$MP.json.hp_method="ccard";if($MP.TwoFieldNames){$MP.json.hp_bname=document.getElementById("MPFirstName").value+" "+document.getElementById("MPLastName").value;$MP.json.hp_c_firstname=document.getElementById("MPFirstName").value;$MP.json.hp_c_lastname=document.getElementById("MPLastName").value}else{$MP.json.hp_bname=document.getElementById("MPName").value}$MP.json.hp_sig_timestamp=dt.getTime().toString();$MP.json.hp_cardnum=cardNumber;$MP.json.hp_expmonth=cardMonth.options[cardMonth.selectedIndex].value;$MP.json.hp_expyear=cardYear.options[cardYear.selectedIndex].value;$MP.json.hp_cvv=cvvNumber};maxipago.prototype.concatUrl=function(){var url=$MP.config.serverUrl;var obj="";url+="?neocia="+encodeURIComponent(Encripta($MP.json.hp_txntype));obj=stringfy($MP.json);url+="&tojebo="+encodeURIComponent(Encripta(obj));url+="&lru="+encodeURIComponent(Encripta($MP.config.urlResponse));return url};maxipago.prototype.sendRequest=function(urlRequest){var self=this;var ifmAux=null;var body=document.getElementsByTagName("body")[0],iframe=document.createElement("iframe");self.frameID="MP_"+(new Date).getTime();var url=urlRequest;iframe.setAttribute("src",url);iframe.setAttribute("name",self.frameID);iframe.setAttribute("id",self.frameID);iframe.setAttribute("frameborder","0");iframe.setAttribute("scrolling","no");iframe.setAttribute("allowtransparency","true");iframe.setAttribute("width",0);iframe.setAttribute("height",0);iframe.setAttribute("style","position:absolute;top:0;left:0;width:0;height:0");var func=function(){ifmAux=window.frames[self.frameID]};iframe.attachEvent?iframe.attachEvent("onload",func):iframe.onload=func;body.appendChild(iframe);window.$Event.addHandler("mpResponse",function(json){$MP.response(json)},self)};maxipago.prototype.response=function(json){$MP.resp=json;$MP.json=null;$("#MPLoading").hide();$("#MPResponse").show();if(json.hp_responsecode=="0"){$("#MPResponseSpan").html($MP.dictionary.success)}else{$("#MPResponseSpan").html($MP.dictionary.error)}if($MP.config.closeModal=="true"){setTimeout(function(){$MP.hide()},parseInt($MP.config.timeCloseModal))}else{$("#Closebtn").show()}};function StringtoXML(text){if(window.ActiveXObject){var doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(text)}else{var parser=new DOMParser();var doc=parser.parseFromString(text,'text/xml')}return doc}function stringfy(obj){var t=typeof(obj);if(t!="object"||obj===null){if(t=="string")obj='"'+obj+'"';return String(obj)}else{var n,v,json=[],arr=(obj&&obj.constructor==Array);for(n in obj){v=obj[n];t=typeof(v);if(t=="string")v='"'+v+'"';else if(t=="object"&&v!==null)v=JSON.stringify(v);json.push((arr?"":'"'+n+'":')+String(v))}return(arr?"[":"{")+String(json)+(arr?"]":"}")}}function Encripta(dados){var mensx="";var l;var i;var j=0;var ch;ch="assbdFbdpdPdpfPdAAdpeoseslsQQEcDDldiVVkadiedkdkLLnm";for(i=0;i<dados.length;i++){j++;l=(Asc(dados.substr(i,1))+(Asc(ch.substr(j,1))));if(j==50){j=1}if(l>255){l-=256}mensx+=(Chr(l))}return mensx}function Descripta(dados){var mensx="";var l;var i;var j=0;var ch;ch="assbdFbdpdPdpfPdAAdpeoseslsQQEcDDldiVVkadiedkdkLLnm";for(i=0;i<dados.length;i++){j++;l=(Asc(dados.substr(i,1))-(Asc(ch.substr(j,1))));if(j==50){j=1}if(l<0){l+=256}mensx+=(Chr(l))}return mensx}function Asc(String){return String.charCodeAt(0)}function Chr(AsciiNum){return String.fromCharCode(AsciiNum)}function XMLWriter(a,b){if(a)this.encoding=a;if(b)this.version=b};(function(){XMLWriter.prototype={encoding:'ISO-8859-1',version:'1.0',formatting:'indented',indentChar:'\t',indentation:1,newLine:'\n',writeStartDocument:function(a){this.close();this.stack=[];this.standalone=a},writeEndDocument:function(){this.active=this.root;this.stack=[]},writeDocType:function(a){this.doctype=a},writeStartElement:function(c,d){if(d)c=d+':'+c;var a=this,b=a.active,e={n:c,a:{},c:[]};if(b){b.c.push(e);this.stack.push(b)}else a.root=e;a.active=e},writeEndElement:function(){this.active=this.stack.pop()||this.root},writeAttributeString:function(a,b){if(this.active)this.active.a[a]=b},writeString:function(a){if(this.active)this.active.c.push(a)},writeElementString:function(a,b,c){this.writeStartElement(a,c);this.writeString(b);this.writeEndElement()},writeCDATA:function(a){this.writeString('<![CDATA['+a+']]>')},writeComment:function(a){this.writeString('<!-- '+a+' -->')},flush:function(){var a=this,b='',c='',d=a.indentation,e=a.formatting.toLowerCase()=='indented',f='<?xml version="'+a.version+'" encoding="'+a.encoding+'"';if(a.stack&&a.stack[0])a.writeEndDocument();if(a.standalone!==undefined)f+=' standalone="'+!!a.standalone+'"';f+=' ?>';f=[f];if(a.doctype&&a.root)f.push('<!DOCTYPE '+a.root.n+' '+a.doctype+'>');if(e){while(d--)b+=a.indentChar}if(a.root)k(a.root,c,b,f);return f.join(e?a.newLine:'')},close:function(){var a=this;if(a.root)j(a.root);a.active=a.root=a.stack=null},getDocument:window.ActiveXObject?function(){var a=new ActiveXObject('Microsoft.XMLDOM');a.async=!1;a.loadXML(this.flush());return a}:function(){return(new DOMParser()).parseFromString(this.flush(),'text/xml')}};function j(a){var l=a.c.length;while(l--){if(typeof a.c[l]=='object')j(a.c[l])}a.n=a.a=a.c=null};function k(a,b,c,d){var e=b+'<'+a.n,f=a.c.length,g,h,i=0;for(g in a.a)e+=' '+g+'="'+a.a[g]+'"';e+=f?'>':' />';d.push(e);if(f){do{h=a.c[i++];if(typeof h=='string'){if(f==1)return d.push(d.pop()+h+'</'+a.n+'>');else d.push(b+c+h)}else if(typeof h=='object')k(h,b+c,c,d)}while(i<f);d.push(b+'</'+a.n+'>')}}})();window.$Event={};(function(s){var events={};s.handleEvent=function(){var evt=arguments[0];var handlers=events[evt];var handler;if(!handlers||handlers.length==0){return false}var len=handlers?handlers.length:0;var args=[];var i=arguments.length-1;for(var x=0;x<i;x++){args[x]=arguments[x+1]}while(len--){handler=handlers[len];if(handler.func){handler.func.apply(handler.ctx,args)}}};s.addHandler=function(evt,func,ctx){if(!events[evt]){events[evt]=[]}events[evt].push({'func':func,'ctx':ctx})};s.removeHandler=function(evt,cb,ctx){var handlers=events[evt];var handler;if(!handlers||handlers.length==0){return false}var len=handlers.length;while(len--){handler=handlers[len];if(handler){if(ctx){if(cb){if(handler.ctx==ctx&&handler.func==cb){handlers.splice(len,1)}}else{handlers.splice(len,1)}}else{handlers.splice(len,1)}}}}})(window.$Event);var $MP=new maxipago();$MP.init();