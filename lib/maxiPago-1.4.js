function maxipago(){var e=this;e.productValue="";e.config={};e.dictionary={};e.iframe=null;e.frameID=null;e.json={};e.resp={};e.TwoFieldNames=false}function StringtoXML(e){if(window.ActiveXObject){var t=new ActiveXObject("Microsoft.XMLDOM");t.async="false";t.loadXML(e)}else{var n=new DOMParser;var t=n.parseFromString(e,"text/xml")}return t}function stringfy(e){var t=typeof e;if(t!="object"||e===null){if(t=="string")e='"'+e+'"';return String(e)}else{var n,r,i=[],s=e&&e.constructor==Array;for(n in e){r=e[n];t=typeof r;if(t=="string")r='"'+r+'"';else if(t=="object"&&r!==null)r=JSON.stringify(r);i.push((s?"":'"'+n+'":')+String(r))}return(s?"[":"{")+String(i)+(s?"]":"}")}}function Encripta(e){var t="";var n;var r;var i=0;var s;s="assbdFbdpdPdpfPdAAdpeoseslsQQEcDDldiVVkadiedkdkLLnm";for(r=0;r<e.length;r++){i++;n=Asc(e.substr(r,1))+Asc(s.substr(i,1));if(i==50){i=1}if(n>255){n-=256}t+=Chr(n)}return t}function Descripta(e){var t="";var n;var r;var i=0;var s;s="assbdFbdpdPdpfPdAAdpeoseslsQQEcDDldiVVkadiedkdkLLnm";for(r=0;r<e.length;r++){i++;n=Asc(e.substr(r,1))-Asc(s.substr(i,1));if(i==50){i=1}if(n<0){n+=256}t+=Chr(n)}return t}function Asc(e){return e.charCodeAt(0)}function Chr(e){return String.fromCharCode(e)}function XMLWriter(e,t){if(e)this.encoding=e;if(t)this.version=t}maxipago.prototype.init=function(){$MP.putExternalFiles();$MP.readConfig();$MP.readDictionary()};maxipago.prototype.readConfig=function(){$.ajax({url:"maxipago/config.xml",dataType:"xml",success:function(e){$MP.config.serverUrl=$(e).find("server_url").text();$MP.config.formWidth=parseInt($(e).find("form_width").text());$MP.config.formHeight=parseInt($(e).find("form_height").text());$MP.config.merchantId=$(e).find("merchantId").text();$MP.config.urlResponse=$(e).find("server_url_response").text();$MP.config.closeModal=$(e).find("closeModal").text();$MP.config.timeCloseModal=$(e).find("timeCloseModal").text();$MP.config.showRefNum=$(e).find("showRefNum").text();$MP.config.showAmount=$(e).find("showAmount").text()}})},maxipago.prototype.readDictionary=function(){$.ajax({url:"maxipago/dictionary.xml",dataType:"xml",success:function(e){$MP.dictionary.fieldCustomName=$(e).find("Field_customerName").text();$MP.dictionary.fieldFirstName=$(e).find("Field_firstName").text();$MP.dictionary.fieldLastName=$(e).find("Field_lastName").text();$MP.dictionary.fieldCardNumber=$(e).find("Field_cardNumber").text();$MP.dictionary.fieldExpirationDate=$(e).find("Field_expirationDate").text();$MP.dictionary.fieldCvv=$(e).find("Field_CVV").text();$MP.dictionary.nameError=$(e).find("customerName_error").text();$MP.dictionary.namesError=$(e).find("customerNames_error").text();$MP.dictionary.cardNumberError=$(e).find("cardNumber_error").text();$MP.dictionary.expDateError=$(e).find("expirationDate_error").text();$MP.dictionary.cvvError=$(e).find("cvv_error").text();$MP.dictionary.btnConfirm=$(e).find("button_confirm").text();$MP.dictionary.btnCancel=$(e).find("button_cancel").text();$MP.dictionary.loading=$(e).find("loading").text();$MP.dictionary.error=$(e).find("error").text();$MP.dictionary.success=$(e).find("success").text();$MP.dictionary.button_close=$(e).find("button_close").text();$MP.dictionary.refNum=$(e).find("refNum").text();$MP.dictionary.amount=$(e).find("amount").text();$MP.dictionary.currency=$(e).find("currency").text();$MP.dictionary.separatorAmount=$(e).find("separator_amount").text();$MP.dictionary.withCI=$(e).find("with_charge_interest").text();$MP.dictionary.withoutCI=$(e).find("without_charge_interest").text()}})};maxipago.prototype.putExternalFiles=function(){var e=document.createElement("link");e.setAttribute("type","text/css");e.setAttribute("href","maxipago/maxipago.css");e.setAttribute("rel","stylesheet");document.getElementsByTagName("head").item(0).appendChild(e)};maxipago.prototype.openModal=function(){var e=$(window).width()==0?$(window).width():$(window).width();var t=$(window).height()==0?$(window).height():$(window).height();var n=(e-$MP.config.formWidth)/2;var r=(t-$MP.config.formHeight)/2;var i="position: absolute;width:100%;height:100%;left:0;top:0;display:none;";var s="position: absolute;left:"+n.toString()+"px;top:"+r.toString()+"px;display:none;";var o="<div id='MPmodalInside' style='"+i+";opacity:0.75;filter:alpha(opacity=75);' class='MPModal'></div>"+"<div id='MPbuyForm' style='"+s+";height:"+$MP.config.formHeight.toString()+"px !important;width:"+$MP.config.formWidth.toString()+"px !important;' class='MPwindow'>"+"<table cellpadding='10' cellspacing='0' class='MPTableHeader'>"+"<tr id='TRrefNum' style='display:none'><td id='mp_refNum' class='MPrefnum'></td><td id='mp_refNumValue' class='MPrefNumValue'></td><tr>"+"<tr id='TRAmount' style='display:none'><td id='mp_amount' class='MPAmount'></td><td id='mp_AmountValue' class='MPAmountValue'></td><tr>"+"<tr id='TRInstallments' style='display:none'><td colspan='2' id='mp_Installments' class='MPInstallments'></td><tr>"+"<tr id='TRspcRefNum' style='display:none'><td></td><td></td><tr>"+"</table>";if($MP.TwoFieldNames){o+="<table class='mpNames'><tr><td id='value_of_FirstName' class='MPtext'><td>"+"<td><input type='text' size='20' class'inputFirstName' maxlength='60' id='MPFirstName'/><td>"+"<td id='value_of_LastName' class='MPtext'></td>"+"<td><input type='text' size='20' class'inputLastName' maxlength='60' id='MPLastName'/>"+"<span id='MPName_error' class='MPerrorText' style='display:none'></span></td></tr></table>"+"<table cellpadding='10' cellspacing='0' class='MPTableForm'>"}else{o+="<table cellpadding='10' cellspacing='0' class='MPTableForm'><tr><td id='value_of_customerName' class='MPtext'></td>"+"<td><input type='text' size='40' maxlength='60' id='MPName'/><span id='MPName_error' class='MPerrorText' style='display:none'></span></td></tr>"}o+="<tr><td id='value_of_cardNumber' class='MPtext'></td>"+"<td><input type='text' size='20' maxlength='19' id='MPcardNumber'><span id='MPcardNumber_error' class='MPerrorText' style='display:none'></span></td></tr>"+"<tr><td id='value_of_expirationDate' class='MPtext'></td>"+"<td><select id='MPmonth'></select> / <select id='MPyear'></select>"+"<span id='MPexpirationDate_error' class='MPerrorText' style='display:none'></span></td></tr>"+"<tr><td id='value_of_CVV' class='MPtext'></td>"+"<td><input type='text' size='4' maxlength='4' id='MPcardCVV'><span id='MPCVV_error' class='MPerrorText' style='display:none'></span></td></tr>"+"</table>"+"<table cellpadding='10' cellspacing='0' class='MPTableButtons'>"+"<tr id='MPbuttons'><td></td><td class='MPbtnsMP'><a class='MPbackButton' id='MPcancelButton' onclick='$MP.hide()'></a>"+"<a class='MPbuyButton' id='MPconfirmButton' onclick='$MP.ConfirmBuy()'></a></td></tr>"+"<tr id='MPLoading' style='display:none'><td colspan='2'><span id='MPLoadingSpan' class='MPLoading'></span></td></tr>"+"<tr id='MPResponse' style='display:none'><td colspan='2'><span id='MPResponseSpan' class='MPResponse'></span></td></tr>"+"<tr id='Closebtn' style='display:none'><td colspan='2' class='MPbtnsMP'><a class='mP_closeButton' id='MPClosebtn' onclick='$MP.hide(); respMPLib();'></a></td></tr>"+"</table>"+"</div>";$(document.body).append(o);$MP.putValues();$(document.body).delegate("#MPcardNumber","keypress",function(e){return $MP.onlyNumbers(e)});$(document.body).delegate("#MPcardCVV","keypress",function(e){return $MP.onlyNumbers(e)});document.body.style.overflow="hidden";if($MP.config.showRefNum=="true"){document.getElementById("TRrefNum").style.display="block";document.getElementById("TRspcRefNum").style.display="block";$("#mp_refNumValue").html($MP.json.hp_refnum)}if($MP.config.showAmount=="true"){document.getElementById("TRAmount").style.display="block";if($MP.config.showRefNum=="true"){document.getElementById("TRspcRefNum").style.display="none"}else{document.getElementById("TRspcRefNum").style.display="none"}$("#mp_AmountValue").html($MP.dictionary.currency+" "+$MP.productValue);if($MP.json.hp_number_of_installments!=null){document.getElementById("TRInstallments").style.display="block";var u=parseFloat($MP.productValue);var a=parseFloat($MP.json.hp_number_of_installments);var f=(u/a).toFixed(2);f=f.replace(".",",");var l="";if($MP.json.hp_charge_interest){l=$MP.json.hp_charge_interest=="S"?$MP.dictionary.withCI:$MP.dictionary.withoutCI}else{l=$MP.dictionary.withoutCI}$("#mp_Installments").html($MP.json.hp_number_of_installments+"x "+$MP.dictionary.separatorAmount+" "+$MP.dictionary.currency+" "+f+" "+l)}}$MP.show()};maxipago.prototype.putValues=function(){$MP.putSelectsValues();$("#value_of_customerName").html($MP.dictionary.fieldCustomName);$("#value_of_FirstName").html($MP.dictionary.fieldFirstName);$("#value_of_LastName").html($MP.dictionary.fieldLastName);$("#value_of_cardNumber").html($MP.dictionary.fieldCardNumber);$("#value_of_expirationDate").html($MP.dictionary.fieldExpirationDate);$("#value_of_CVV").html($MP.dictionary.fieldCvv);if($MP.TwoFieldNames){$("#MPName_error").html($MP.dictionary.namesError)}else{$("#MPName_error").html($MP.dictionary.nameError)}$("#MPcardNumber_error").html($MP.dictionary.cardNumberError);$("#MPexpirationDate_error").html($MP.dictionary.expDateError);$("#MPCVV_error").html($MP.dictionary.cvvError);$("#MPconfirmButton").html($MP.dictionary.btnConfirm);$("#MPcancelButton").html($MP.dictionary.btnCancel);$("#MPLoadingSpan").html($MP.dictionary.loading);$("#MPClosebtn").html($MP.dictionary.button_close);$("#mp_refNum").html($MP.dictionary.refNum);$("#mp_amount").html($MP.dictionary.amount)};maxipago.prototype.putSelectsValues=function(){var e=document.getElementById("MPmonth");var t=document.getElementById("MPyear");var n="";var r="";var i="";var s=new Date;var o=s.getFullYear();for(var u=0;u<12;u++){r=u+1;r=r.toString();if(r.length==1){r="0"+r}n=document.createElement("option");n.text=r;n.value=r;e.add(new Option(r,r))}for(var a=0;a<10;a++){i=o+a;n=document.createElement("option");n.text=i;n.value=i;t.add(new Option(i,i))}};maxipago.prototype.onlyNumbers=function(e){var t=window.event?event.keyCode:e.which;if(t>47&&t<58)return true;else{if(t==8||t==0)return true;else return false}};maxipago.prototype.hideErrors=function(){$("#MPName_error").hide();$("#MPcardNumber_error").hide();$("#MPCVV_error").hide()};maxipago.prototype.show=function(){$("#MPmodalInside").show();$("#MPbuyForm").show()};maxipago.prototype.showLoading=function(e){if(e){$("#MPbuttons").hide();$("#MPLoading").show("fade")}else{$("#MPLoading").hide();$("#MPbuttons").show("fade")}};maxipago.prototype.hide=function(){document.body.style.overflow="auto";$("#MPmodalInside").hide();$("#MPbuyForm").hide();setTimeout(function(){$("#MPmodalInside").remove();$("#MPbuyForm").remove()},200)};maxipago.prototype.Buy=function(e){if(e.hp_processor_id==null){alert("hp_processor_id cannot be null");return false}if(e.hp_txntype==null){alert("hp_txntype cannot be null");return false}if(e.hp_amount==null){alert("hp_amount cannot be null");return false}if(e.hp_refnum==null){alert("hp_refnum cannot be null");return false}if(e.hp_sig_itemid==null){alert("hp_sig_itemid cannot be null");return false}if(e.hp_sig_id==null){alert("hp_sig_id cannot be null");return false}$MP.productValue=e.hp_amount;if($MP.config.formHeight==null){console.log("error - xml config - não carregado")}else{$MP.json=e;if($MP.json.hp_save_customer){if($MP.json.hp_save_customer=="1"){$MP.TwoFieldNames=true}}$MP.openModal()}};maxipago.prototype.ConfirmBuy=function(){$MP.showLoading(true);$MP.hideErrors();var e=document.getElementById("MPcardNumber").value;var t=document.getElementById("MPcardCVV").value;var n="";if($MP.TwoFieldNames){var r=document.getElementById("MPFirstName").value;var i=document.getElementById("MPLastName").value;if(r==""||i==""){$("#MPName_error").show();$MP.showLoading(false);return false}}else{n=document.getElementById("MPName").value;if(n==""){$("#MPName_error").show();$MP.showLoading(false);return false}}if(e==""){$("#MPcardNumber_error").show();$MP.showLoading(false);return false}if(t==""){$("#MPCVV_error").show();$MP.showLoading(false);return false}$MP.CompleteJson(n,e,t);var s=$MP.concatUrl();$MP.sendRequest(s)};maxipago.prototype.CompleteJson=function(e,t,n){var r=document.getElementById("MPmonth");var i=document.getElementById("MPyear");var s=new Date;$MP.json.hp_merchant_id=$MP.config.merchantId;$MP.json.hp_method="ccard";if($MP.TwoFieldNames){$MP.json.hp_bname=document.getElementById("MPFirstName").value+" "+document.getElementById("MPLastName").value;$MP.json.hp_c_firstname=document.getElementById("MPFirstName").value;$MP.json.hp_c_lastname=document.getElementById("MPLastName").value}else{$MP.json.hp_bname=document.getElementById("MPName").value}$MP.json.hp_cardnum=t;$MP.json.hp_expmonth=r.options[r.selectedIndex].value;$MP.json.hp_expyear=i.options[i.selectedIndex].value;$MP.json.hp_cvv=n;$MP.json.from_paypage=1};maxipago.prototype.concatUrl=function(){var e=$MP.config.serverUrl;var t="";e+="?neocia="+encodeURIComponent(Encripta($MP.json.hp_txntype));t=stringfy($MP.json);e+="&tojebo="+encodeURIComponent(Encripta(t));e+="&lru="+encodeURIComponent(Encripta($MP.config.urlResponse));return e};maxipago.prototype.sendRequest=function(e){var t=this;var n=null;var r=document.getElementsByTagName("body")[0],i=document.createElement("iframe");t.frameID="MP_"+(new Date).getTime();var s=e;i.setAttribute("src",s);i.setAttribute("name",t.frameID);i.setAttribute("id",t.frameID);i.setAttribute("frameborder","0");i.setAttribute("scrolling","no");i.setAttribute("allowtransparency","true");i.setAttribute("width",0);i.setAttribute("height",0);i.setAttribute("style","position:absolute;top:0;left:0;width:0;height:0");var o=function(){n=window.frames[t.frameID]};i.attachEvent?i.attachEvent("onload",o):i.onload=o;r.appendChild(i);window.$Event.addHandler("mpResponse",function(e){$MP.response(e)},t)};maxipago.prototype.response=function(e){$MP.resp=e;$MP.json=null;$("#MPLoading").hide();$("#MPResponse").show();if(e.hp_responsecode=="0"){$("#MPResponseSpan").html($MP.dictionary.success)}else{$("#MPResponseSpan").html($MP.dictionary.error)}if($MP.config.closeModal=="true"){setTimeout(function(){$MP.hide()},parseInt($MP.config.timeCloseModal))}else{$("#Closebtn").show()}};(function(){function e(t){var n=t.c.length;while(n--){if(typeof t.c[n]=="object")e(t.c[n])}t.n=t.a=t.c=null}function t(e,n,r,i){var s=n+"<"+e.n,o=e.c.length,u,a,f=0;for(u in e.a)s+=" "+u+'="'+e.a[u]+'"';s+=o?">":" />";i.push(s);if(o){do{a=e.c[f++];if(typeof a=="string"){if(o==1)return i.push(i.pop()+a+"</"+e.n+">");else i.push(n+r+a)}else if(typeof a=="object")t(a,n+r,r,i)}while(f<o);i.push(n+"</"+e.n+">")}}XMLWriter.prototype={encoding:"ISO-8859-1",version:"1.0",formatting:"indented",indentChar:"	",indentation:1,newLine:"\n",writeStartDocument:function(e){this.close();this.stack=[];this.standalone=e},writeEndDocument:function(){this.active=this.root;this.stack=[]},writeDocType:function(e){this.doctype=e},writeStartElement:function(e,t){if(t)e=t+":"+e;var n=this,r=n.active,i={n:e,a:{},c:[]};if(r){r.c.push(i);this.stack.push(r)}else n.root=i;n.active=i},writeEndElement:function(){this.active=this.stack.pop()||this.root},writeAttributeString:function(e,t){if(this.active)this.active.a[e]=t},writeString:function(e){if(this.active)this.active.c.push(e)},writeElementString:function(e,t,n){this.writeStartElement(e,n);this.writeString(t);this.writeEndElement()},writeCDATA:function(e){this.writeString("<![CDATA["+e+"]]>")},writeComment:function(e){this.writeString("<!-- "+e+" -->")},flush:function(){var e=this,n="",r="",i=e.indentation,s=e.formatting.toLowerCase()=="indented",o='<?xml version="'+e.version+'" encoding="'+e.encoding+'"';if(e.stack&&e.stack[0])e.writeEndDocument();if(e.standalone!==undefined)o+=' standalone="'+!!e.standalone+'"';o+=" ?>";o=[o];if(e.doctype&&e.root)o.push("<!DOCTYPE "+e.root.n+" "+e.doctype+">");if(s){while(i--)n+=e.indentChar}if(e.root)t(e.root,r,n,o);return o.join(s?e.newLine:"")},close:function(){var t=this;if(t.root)e(t.root);t.active=t.root=t.stack=null},getDocument:window.ActiveXObject?function(){var e=new ActiveXObject("Microsoft.XMLDOM");e.async=!1;e.loadXML(this.flush());return e}:function(){return(new DOMParser).parseFromString(this.flush(),"text/xml")}};})();window.$Event={};(function(e){var t={};e.handleEvent=function(){var e=arguments[0];var n=t[e];var r;if(!n||n.length==0){return false}var i=n?n.length:0;var s=[];var o=arguments.length-1;for(var u=0;u<o;u++){s[u]=arguments[u+1]}while(i--){r=n[i];if(r.func){r.func.apply(r.ctx,s)}}};e.addHandler=function(e,n,r){if(!t[e]){t[e]=[]}t[e].push({func:n,ctx:r})};e.removeHandler=function(e,n,r){var i=t[e];var s;if(!i||i.length==0){return false}var o=i.length;while(o--){s=i[o];if(s){if(r){if(n){if(s.ctx==r&&s.func==n){i.splice(o,1)}}else{i.splice(o,1)}}else{i.splice(o,1)}}}}})(window.$Event);var $MP=new maxipago;$MP.init()